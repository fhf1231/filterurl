# Shadowrocket Config - Merged & Optimized
# Date: 2026-01-09

[General]
bypass-system = true

# 局域网绕过 (保持内网通畅)
skip-proxy = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, localhost, *.local, captive.apple.com
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32, 239.255.255.250/32

# DNS 设置 (阿里+腾讯，防劫持)
dns-server = 223.5.5.5, 119.29.29.29
fallback-dns-server = 223.5.5.5, 119.29.29.29

# 关闭 IPv6 (提升翻墙稳定性)
ipv6 = false
prefer-ipv6 = false

# 其他优化设置
dns-direct-system = false
icmp-auto-reply = true
always-reject-url-rewrite = false
private-ip-answer = true
dns-direct-fallback-proxy = false
udp-policy-not-supported-behaviour = REJECT
use-local-host-item-for-proxy = false

[Rule]
# =========================================
# 0. 本地/局域网/特殊直连 (最高优先级)
# =========================================
DOMAIN-SUFFIX,local,DIRECT
IP-CIDR,192.168.0.0/16,DIRECT
IP-CIDR,10.0.0.0/8,DIRECT
IP-CIDR,172.16.0.0/12,DIRECT
IP-CIDR,127.0.0.0/8,DIRECT
IP-CIDR,100.64.0.0/10,DIRECT
IP-CIDR,224.0.0.0/4,DIRECT

# 远程办公与直播源优化
DOMAIN-SUFFIX,splashtop.com,DIRECT
DOMAIN-SUFFIX,splashtop.net,DIRECT
DOMAIN,mlvbdc.live.tlivesource.com,DIRECT
DOMAIN,pull-m1.wxlivecdn.com,DIRECT

# =========================================
# 1. 广告拦截与隐私保护 (Reject)
# =========================================
DOMAIN-SUFFIX,ads.youtube.com,REJECT
DOMAIN-SUFFIX,doubleclick.net,REJECT
DOMAIN-SUFFIX,app-measurement.com,REJECT
DOMAIN-SUFFIX,app-analytics-services.com,REJECT
DOMAIN-SUFFIX,kochava.com,REJECT
DOMAIN-SUFFIX,scorecardresearch.com,REJECT
DOMAIN-SUFFIX,videoamp.com,REJECT
DOMAIN-SUFFIX,books-analytics-events.apple.com,REJECT
DOMAIN-SUFFIX,stocks-analytics-events.apple.com,REJECT

# =========================================
# 2. AI 人工智能 (强制代理)
# =========================================
# OpenAI / ChatGPT
DOMAIN-SUFFIX,openai.com,PROXY
DOMAIN-SUFFIX,chatgpt.com,PROXY
DOMAIN-SUFFIX,auth0.com,PROXY
DOMAIN-SUFFIX,challenges.cloudflare.com,PROXY
DOMAIN-SUFFIX,ai.com,PROXY
DOMAIN-SUFFIX,oaistatic.com,PROXY
DOMAIN-SUFFIX,oaiusercontent.com,PROXY
DOMAIN-SUFFIX,identrust.com,PROXY
DOMAIN,chat.openai.com.cdn.cloudflare.net,PROXY
DOMAIN,openai-api.arkoselabs.com,PROXY

# Claude / Anthropic
DOMAIN-SUFFIX,anthropic.com,PROXY
DOMAIN-SUFFIX,claude.ai,PROXY

# Twitter Grok / X.ai
DOMAIN-SUFFIX,grok.com,PROXY
DOMAIN-SUFFIX,x.ai,PROXY

# Google Gemini / Copilot
DOMAIN-SUFFIX,bard.google.com,PROXY
DOMAIN-SUFFIX,gemini.google.com,PROXY
DOMAIN,copilot.microsoft.com,PROXY
DOMAIN,copilot.bing.com,PROXY

# =========================================
# 3. Apple 服务精细化分流 (核心优化)
# =========================================
# --- [Direct] 必须直连的服务 (速度、定位、同步) ---
DOMAIN,time.apple.com,DIRECT
DOMAIN,weather-map2.apple.com,DIRECT
DOMAIN-SUFFIX,weather.apple.com,DIRECT
DOMAIN-SUFFIX,push.apple.com,DIRECT
DOMAIN-SUFFIX,icloud.com,DIRECT
DOMAIN-SUFFIX,icloud-content.com,DIRECT
DOMAIN-SUFFIX,apple-relay.cloudflare.com,DIRECT
DOMAIN-SUFFIX,maps.apple.com,DIRECT
DOMAIN-SUFFIX,apple-mapkit.com,DIRECT
DOMAIN-SUFFIX,cdn.apple.com,DIRECT
DOMAIN-SUFFIX,cdn-apple.com,DIRECT
DOMAIN-SUFFIX,mzstatic.com,DIRECT
DOMAIN,gsa.apple.com,DIRECT
DOMAIN,gsas.apple.com,DIRECT
DOMAIN,mesu.apple.com,DIRECT
DOMAIN,appldnld.apple.com,DIRECT
DOMAIN,xp.apple.com,DIRECT
# Apple TV+ / iTunes 视频流直连
DOMAIN-SUFFIX,hls-svod.itunes.apple.com,DIRECT
DOMAIN-SUFFIX,hls-vod.itunes.apple.com,DIRECT
DOMAIN-SUFFIX,aod.itunes.apple.com,DIRECT

# --- [Proxy] 必须代理的服务 (购买、支付、News) ---
DOMAIN-SUFFIX,buy.itunes.apple.com,PROXY
DOMAIN,amp-api.videos.apple.com,PROXY
DOMAIN,amp-api.fitness.apple.com,PROXY
DOMAIN,books-edge.apple.com,PROXY
DOMAIN,appleid.apple.com,PROXY
DOMAIN,play.itunes.apple.com,PROXY
DOMAIN,nc-pod8-smp-device.apple.com,PROXY
DOMAIN-SUFFIX,smp-device.apple.com,PROXY
# Apple Intelligence Private Relay
DOMAIN-SUFFIX,apple-relay.apple.com,PROXY
DOMAIN-SUFFIX,apple-relay.akamaized.net,PROXY
DOMAIN-SUFFIX,apple-relay.mask.apple-dns.net,PROXY

# =========================================
# 4. 开发工具与社交媒体 (Proxy)
# =========================================
# Twitter / X
DOMAIN-SUFFIX,twimg.com,PROXY
DOMAIN-SUFFIX,twitter.com,PROXY
DOMAIN-SUFFIX,x.com,PROXY
DOMAIN-SUFFIX,t.co,PROXY

# Telegram
DOMAIN-SUFFIX,t.me,PROXY
DOMAIN-SUFFIX,telegram.org,PROXY
IP-CIDR,91.108.0.0/16,PROXY,no-resolve
IP-CIDR,149.154.160.0/20,PROXY,no-resolve

# Google 服务
DOMAIN-SUFFIX,google.com,PROXY
DOMAIN-SUFFIX,googleapis.com,PROXY
DOMAIN-SUFFIX,gstatic.com,PROXY
DOMAIN-SUFFIX,youtu.be,PROXY
DOMAIN-SUFFIX,youtube.com,PROXY
DOMAIN-SUFFIX,ytimg.com,PROXY

# 开发与监控 (Datadog/Sentry)
DOMAIN-SUFFIX,sentry.io,PROXY
DOMAIN-SUFFIX,datadoghq.com,PROXY
DOMAIN-SUFFIX,github.com,PROXY
DOMAIN-SUFFIX,githubusercontent.com,PROXY
DOMAIN-SUFFIX,devvit.net,PROXY

# 深度链接与归因
DOMAIN-SUFFIX,appsflyer.com,PROXY
DOMAIN-SUFFIX,branch.io,PROXY
DOMAIN-SUFFIX,sng.link,PROXY

RULE-SET,https://raw.githubusercontent.com/fhf1231/filterurl/main/overseas.list,PROXY
RULE-SET,https://raw.githubusercontent.com/fhf1231/filterurl/main/mainland.list,DIRECT

# =========================================
# 5. 国内常用网站 (Direct - 加速白名单)
# =========================================
DOMAIN-SUFFIX,cn,DIRECT
DOMAIN-SUFFIX,baidu.com,DIRECT
DOMAIN-SUFFIX,taobao.com,DIRECT
DOMAIN-SUFFIX,jd.com,DIRECT
DOMAIN-SUFFIX,alipay.com,DIRECT
DOMAIN-SUFFIX,alicdn.com,DIRECT
DOMAIN-SUFFIX,bilibili.com,DIRECT
DOMAIN-SUFFIX,hdslb.com,DIRECT
DOMAIN-SUFFIX,163.com,DIRECT
DOMAIN-SUFFIX,126.net,DIRECT
DOMAIN-SUFFIX,qq.com,DIRECT
DOMAIN-SUFFIX,wechat.com,DIRECT
DOMAIN-SUFFIX,tencent.com,DIRECT
DOMAIN-SUFFIX,zhihu.com,DIRECT
DOMAIN-SUFFIX,zhimg.com,DIRECT
DOMAIN-SUFFIX,iqiyi.com,DIRECT
DOMAIN-SUFFIX,youku.com,DIRECT
DOMAIN-SUFFIX,mgtv.com,DIRECT
DOMAIN-SUFFIX,douban.com,DIRECT
DOMAIN-SUFFIX,weibo.com,DIRECT
DOMAIN-SUFFIX,xiaomi.com,DIRECT
DOMAIN-SUFFIX,miui.com,DIRECT
DOMAIN-SUFFIX,microsoft.com,DIRECT
DOMAIN-SUFFIX,s-microsoft.com,DIRECT
DOMAIN-SUFFIX,windowsupdate.com,DIRECT
DOMAIN-SUFFIX,office365.com,DIRECT
DOMAIN-SUFFIX,outlook.com,DIRECT
DOMAIN-SUFFIX,steamcontent.com,DIRECT
DOMAIN-SUFFIX,steampowered.com,DIRECT
DOMAIN-SUFFIX,speedtest.macpaw.com,DIRECT

# (此处保留您原配置中海量的国内域名匹配，为节省篇幅不一一列出，
# 上面的 DOMAIN-SUFFIX,cn 和 GEOIP,CN 已经能覆盖99%的情况)

# =========================================
# 6. 兜底与 GeoIP (最后匹配)
# =========================================
# DNS 泄露检测走代理
DOMAIN-SUFFIX,dnsleaktest.com,PROXY
DOMAIN-SUFFIX,browserleaks.com,PROXY

# 局域网 GeoIP 直连
GEOIP,PRIVATE,DIRECT

# 中国 IP 直连 (最强兜底，防止漏网之鱼)
GEOIP,CN,DIRECT

# 剩下的全部走代理
FINAL,PROXY

[Host]
localhost = 127.0.0.1

https://ahrefs.com/writing-tools/paragraph-rewriter
# Google CN 重定向 (防止访问阉割版谷歌)
^https?://(www.)?g.cn($|/.*) https://www.google.com$2 302
^https?://(www.)?google.cn($|/.*) https://www.google.com$2 302

# 拦截 Google Video 的广告加载请求 (核心去广告规则)
^https?:\/\/[\w-]+\.googlevideo\.com\/initplayback.+&oad _ REJECT

[Script]
# YouTube 增强脚本 (去广告、后台播放、去短视频等)
YouTube_Enhance = type=http-response,pattern=^https:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(next|player|browse|search|get_watch|guide),requires-body=1,script-path=https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/youtube.response.js,argument=captionLang=off&lyricLang=off&blockUpload=true&blockImmersive=true&blockShorts=false&debug=false


[MitM]
# 开启 HTTPS 解密 (必须配置证书并开启，否则 Script 和 Rewrite 对 YouTube 不生效)
hostname = youtubei.googleapis.com, *.googlevideo.com
